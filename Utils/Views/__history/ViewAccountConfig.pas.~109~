unit ViewAccountConfig;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, BodyAccountClass, xSuperObject, xSuperJSON,
  System.RTTI;

type
  TViewAccountConfig = class(TForm)
    GroupBox3: TGroupBox;
    btnCancelRequest: TButton;
    btnConfirmRequest: TButton;
    cbxReceiveKey: TCheckBox;
    Chaves: TGroupBox;
    Chave: TLabel;
    txtKey: TEdit;
    cbxTxidMandatory: TCheckBox;
    cbxRefuseAll: TCheckBox;
    procedure FormCreate(Sender: TObject);
    procedure btnConfirmRequestClick(Sender: TObject);
    procedure btnCancelRequestClick(Sender: TObject);
  private
    function GetBody: String;
  public
    property Body: String read GetBody;
    function TransformObjectJson(const Value: String): String;
    procedure ClearRequestfields;
    function NewAliasKey : String;
  end;

implementation

{$R *.dfm}

procedure TViewAccountConfig.btnCancelRequestClick(Sender: TObject);
begin
  ModalResult := mrCancel
end;

procedure TViewAccountConfig.btnConfirmRequestClick(Sender: TObject);
begin
  ModalResult := mrOk
end;

procedure TViewAccountConfig.ClearRequestfields;
begin
  txtKey.Text := '';
end;

procedure TViewAccountConfig.FormCreate(Sender: TObject);
begin
  Self.Position := poScreenCenter;
end;

function TViewAccountConfig.GetBody: String;
var
  BodyRequest : TBodyAccountPixClass;
  Key         : TKey;
  KeyGN       : TKeyGN;
  ReceiveKey  : TReceiveKey;
  RefuseAll   : TRefuseAll;
  Pix         : TPix;
  Body        : iSuperObject;
  teste : String;
begin
  BodyRequest := TBodyAccountPixClass.Create;

  KeyGN       := TKeyGN.Create;
  Key         := TKey.Create;
  ReceiveKey  := TReceiveKey.Create;
  Pix         := TPix.Create;

  RefuseAll.RefuseAll := cbxRefuseAll.Checked;
  ReceiveKey.TxidMandatory := cbxTxidMandatory.Checked;
  Pix.ReceiveKey := cbxReceiveKey.Checked;

  ReceiveKey.QrCodeStatic := RefuseAll;
  KeyGN.Receive := ReceiveKey;
  Key.KeyGN := KeyGN;
  Pix.Key := Key;
  BodyRequest.Pix := Pix;

  Result := BodyRequest.AsJSON;
end;

function TViewAccountConfig.TransformObjectJson (Const Value :String) : String;
begin

  //Transformando o Json altarando o valor de 'aliasChavePix' -> 'txtKey'
  Result := StringReplace(Value, 'aliasKeyGN' , txtKey.Text, [rfReplaceAll]);
end;

function TViewAccountConfig.NewAliasKey : String;
begin
  Result := txtKey.Text;
end;

end.
